# PyGuetzli

[![Build Status](https://travis-ci.org/wanadev/pyguetzli.svg?branch=master)](https://travis-ci.org/wanadev/pyguetzli)
[![PYPI Version](https://img.shields.io/pypi/v/pyguetzli.svg)](https://pypi.python.org/pypi/pyguetzli)


**PyGuetzli** is a Python bindings for Google's [Guetzli][guetzli].

Description of **Guetzli** from official's repo:

> Guetzli is a JPEG encoder that aims for excellent compression density at high
> visual quality. Guetzli-generated images are typically 20-30% smaller than
> images of equivalent quality generated by libjpeg. Guetzli generates only
> sequential (nonprogressive) JPEGs due to faster decompression speeds they
> offer.

[guetzli]: https://github.com/google/guetzli


## Building and Installing PyGuetzli

In order to build Guetzli, GCC and GNU Make are required. On Debian / Ubuntu,
this can be installed with the following command:

    sudo apt-get install build-essential


### Installing from PYPI

To install PyGuetzli from the PYPI package, just run the following command:

    pip install pyguetzli

__NOTE:__ a C++ compilator is still required.


### Installing from source

To build and install PyGuetzli from source, clone the repository, and run the
`pip install` command from the project's root directory:

    git clone https://github.com/wanadev/pyguetzli.git
    cd pyguetzli
    pip install .


## Using PyGuetzli

### Optimizing from a file

```python
import pyguetzli

# Optimizing the image
image = pyguetzli.process_image_from_file("image.jpg", quality=95)

# Getting bytes of the optimized image
image_bytes = image.to_bytes()
print(image_bytes[:10])  # -> "\xFF\xD8\xFF\xE0\x00\x10JFIF"

# Writing the optimized image
image.save("optimized.jpg")
```

__NOTE__: Only JPEG files are supported. See the "Working with PIL / Pillow"
section below if you need to support other formats.


### Optimizing from bytes

```python
import pyguetzli

data = open("image.jpg", "rb").read()

# Optimizing the image
image = pyguetzli.process_image_from_bytes(data, quality=95)

# Getting bytes of the optimized image
image_bytes = image.to_bytes()
print(image_bytes[:10])  # -> "\xFF\xD8\xFF\xE0\x00\x10JFIF"

# Writing the optimized image
image.save("optimized.jpg")
```

__NOTE__: Only JPEG files are supported. See the "Working with PIL / Pillow"
section below if you need to support other formats.


### Optimizing from RGB bytes

This funciton allows you to generate an optimized JPEG from any decoded RGB
image.

```python
import pyguetzli

# This is a 2x2 px image with a red, a green, a blue and a white pixels
data = data = image_pixels = bytes(bytearray([
    0xFF, 0x00, 0x00,   0x00, 0xFF, 0x00,
    0x00, 0x00, 0xFF,   0xFF, 0xFF, 0xFF,
    ]))

# Generating an optimized JPEG image
image = pyguetzli.process_rgb_bytes(data, quality=95)

# Writing the optimized image
image.save("optimized.jpg")
```


### Working with PIL / Pillow

```python
import pyguetzli
from PIL import Image

# PIL image
image = Image.open("./test/image.png")

# Getting bytes from the PIL image
image_rgb_bytes = image.tobytes()

# Generating an optimized JPEG from the bytes
guetzli_image = pyguetzli.process_rgb_bytes(
        image_rgb_bytes,
        image.width,
        image.height,
        quality=95)

# Saving the image
guetzli_image.save("out.jpg")
```

__WARNING:__ if you have an RGBA image, you **must** convert it to RGB first.
See [this Stackoverflow thread][stackoverflow] for more informations.

[stackoverflow]: http://stackoverflow.com/questions/9166400/convert-rgba-png-to-rgb-with-pil?answertab=votes#tab-top


## Testing

    pip install cffi pytest
    python setup.py develop
    pytest


## Changelog

* **0.9.0**: Initial release
